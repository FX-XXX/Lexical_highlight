<!DOCTYPE><html><head><meta http-equiv='Content-Type' content='text/html; charset=UTF-8' /><title>code highlight</title><style type='text/css'>ol{background:rgb(236, 240, 245)}</style></head><body><h2>Code Highlight</h2><ol><span style=color:Brown>#include <stdio.h></span><br><span style=color:Brown>#include <stdlib.h></span><br><span style=color:Brown>#include <string.h></span><br><span style=color:Brown>#include <sys/socket.h></span><br><span style=color:Brown>#include <netinet/in.h></span><br><span style=color:Brown>#include <sys/types.h></span><br><span style=color:Brown>#include <netdb.h></span><br><span style=color:Brown>#include <unistd.h></span><br><span style=color:Brown>#define BUFFSIZE 4096</span><br><span style=color:Brown>#define TEXT_BUFFSIZE 1024</span><br><span style=color:Brown>#define PORT 80</span><br><br><span style=color:Purple>void</span> <span>geturl</span>(<span style=color:Purple>char</span> *<span>url</span>) {<br>	<span style=color:Purple>char</span> <span>myurl</span>[<span>BUFFSIZE</span>], <span>host</span>[<span>BUFFSIZE</span>], <br>		<span>GET</span>[<span>BUFFSIZE</span>], <span>request</span>[<span>BUFFSIZE</span>],<br>		<span>text</span>[<span>BUFFSIZE</span>], *<span>phost</span> = <span style=color:Red>0</span>;<br>	<span style=color:Purple>int</span> <span>socketid</span>, <span>connectid</span>, <span>res</span>, <span>recvid</span>, <span>flag</span> = <span style=color:Red>1</span>;<br>	<span style=color:Blue>struct</span> <span>hostent</span> *<span>purl</span> = <span>NULL</span>;<br>	<span style=color:Blue>struct</span> <span>sockaddr_in</span> <span>sockinfo</span>;<br><br>	<span>memset</span>(<span>myurl</span>, <span style=color:Red>0</span>, <span>BUFFSIZE</span>);<br>	<span>memset</span>(<span>host</span>, <span style=color:Red>0</span>, <span>BUFFSIZE</span>);<br>	<span>memset</span>(<span>GET</span>, <span style=color:Red>0</span>, <span>BUFFSIZE</span>);<br>	<span>strcpy</span>(<span>myurl</span>, <span>url</span>);<br>	<span style=color:LimeGreen>// 设置连接信息结构</span><br><br>	<span>memset</span>(&<span>sockinfo</span>, <span style=color:Red>0</span>, <span style=color:Blue>sizeof</span>(<span style=color:Blue>struct</span> <span>sockaddr_in</span>));<br>	<span>sockinfo</span>.<span>sin_family</span> = <span>AF_INET</span>;<br>	<span>sockinfo</span>.<span>sin_addr</span>.<span>s_addr</span> = *((<span style=color:Purple>unsigned</span> <span style=color:Purple>long</span> *)<span>purl</span>-><span>h_addr_list</span>[<span style=color:Red>0</span>]);<br>	<span>sockinfo</span>.<span>sin_port</span> = <span>htons</span>(<span>PORT</span>);<br><br>	<span style=color:LimeGreen>// 构造http请求</span><br><br>	<span>memset</span>(<span>request</span>, <span style=color:Red>0</span>, <span>BUFFSIZE</span>);<br>	<span>strcat</span>(<span>request</span>, <span style=color:Orange>"GET "</span>);<br>	<span>strcat</span>(<span>request</span>, <span>GET</span>);<br>	<span>strcat</span>(<span>request</span>, <span style=color:Orange>" HTTP/1.1\r\n"</span>);<br>	<span style=color:LimeGreen>// 以上为http请求行信息</span><br><br>	<span>strcat</span>(<span>request</span>, <span style=color:Orange>"HOST: "</span>);<br>	<span>strcat</span>(<span>request</span>, <span>host</span>);<br>	<span>strcat</span>(<span>request</span>, <span style=color:Orange>"\r\n"</span>);<br>	<span>strcat</span>(<span>request</span>, <span style=color:Orange>"User-Agent: "</span>);<br>	<span>strcat</span>(<span>request</span>, <span style=color:Orange>"2333 Browser"</span>);<br>	<span>strcat</span>(<span>request</span>, <span style=color:Orange>"\r\n"</span>);<br>	<span>strcat</span>(<span>request</span>, <span style=color:Orange>"Author: "</span>);<br>	<span>strcat</span>(<span>request</span>, <span style=color:Orange>"By Jiavan&Keeln&LZY"</span>);<br>	<span>strcat</span>(<span>request</span>, <span style=color:Orange>"\r\n"</span>);<br>	<span>strcat</span>(<span>request</span>,<span style=color:Orange>"Cache-Control: no-cache\r\n\r\n"</span>);<br><br>	<span style=color:LimeGreen>// 连接到远端服务器</span><br><br>	<span>connectid</span> = <span>connect</span>(<span>socketid</span>, (<span style=color:Blue>struct</span> <span>sockaddr</span>*)&<span>sockinfo</span>, <span style=color:Blue>sizeof</span>(<span>sockinfo</span>));<br>	<span style=color:Blue>if</span> (<span>connectid</span> == -<span style=color:Red>1</span>) {<br>		<span>printf</span>(<span style=color:Orange>"连接远端服务器失败\n"</span>);<br>		<span>exit</span>(<span style=color:Red>1</span>);<br>	}<br>	<span>printf</span>(<span style=color:Orange>"-> 连接到远端服务器成功\n"</span>);<br><br>	<span style=color:LimeGreen>// 向服务器发送GET请求</span><br><br>	<span>res</span> = <span>send</span>(<span>socketid</span>, <span>request</span>, <span>strlen</span>(<span>request</span>), <span style=color:Red>0</span>);<br>	<span style=color:Blue>if</span> (<span>res</span> == -<span style=color:Red>1</span>) {<br>		<span>printf</span>(<span style=color:Orange>"向服务器发送GET请求失败\n"</span>);<br>		<span>exit</span>(<span style=color:Red>1</span>);<br>	}<br>	<span>printf</span>(<span style=color:Orange>"-> 发送GET请求成功，共发送了%d bytes\n"</span>, <span>res</span>);<br>	<span>printf</span>(<span style=color:Orange>"-> HTTP请求报文如下\n--------HTTP Request--------\n%s\n"</span>, <span>request</span>);<br>	<span>printf</span>(<span style=color:Orange>"-> HTTP响应内容正在重定向至index.html\n"</span>);<br><br>	<span style=color:LimeGreen>// 接受服务器的响应</span><br><br>	<span style=color:Blue>if</span> (<span>freopen</span>(<span style=color:Orange>"index.html"</span>, <span style=color:Orange>"w"</span>, <span>stdout</span>) == <span>NULL</span>) {<br>		<span>printf</span>(<span style=color:Orange>"输出重定向错误\n"</span>);<br>		<span>exit</span>(<span style=color:Red>1</span>);<br>	} <span style=color:Blue>else</span> {<br>		<span style=color:Blue>while</span> (<span>flag</span>) {<br>			<span>memset</span>(<span>text</span>, <span style=color:Red>0</span>, <span>TEXT_BUFFSIZE</span>);<br>			<span style=color:Purple>int</span> <span>bufflen</span> = <span>recv</span>(<span>socketid</span>, <span>text</span>, <span>TEXT_BUFFSIZE</span>, <span style=color:Red>0</span>);<br>			<br>			<span style=color:Blue>if</span> (<span>bufflen</span> < <span style=color:Red>0</span>) {<br>				<span>printf</span>(<span style=color:Orange>"接收数据流出错\n"</span>);<br>				<span>fclose</span>(<span>stdout</span>);<br>				<span>close</span>(<span>socketid</span>);<br>				<span>exit</span>(<span style=color:Red>1</span>);<br>			}<br>			<span style=color:Blue>if</span> (<span>bufflen</span> > <span style=color:Red>0</span>) {<br>				<span>printf</span>(<span style=color:Orange>"%s\n"</span>, <span>text</span>);<br>			} <span style=color:Blue>else</span> {<br>				<span>flag</span> = <span style=color:Red>0</span>;<br>			}<br>		}<br>	}<br>	<span>fclose</span>(<span>stdout</span>);<br>	<span>close</span>(<span>socketid</span>);<br>}<br><br><span style=color:Purple>int</span> <span>main</span>(<span style=color:Purple>int</span> <span>argc</span>, <span style=color:Purple>char</span> *<span>argv</span>[])<br>{<br>	<span style=color:Blue>if</span> (<span>argc</span> < <span style=color:Red>2</span>) {<br>		<span>printf</span>(<span style=color:Orange>"请输入正确的URL参数\n"</span>);<br>		<span>exit</span>(<span style=color:Red>1</span>);<br>	}<br>	<span>geturl</span>(<span>argv</span>[<span style=color:Red>1</span>]);<br>	<span style=color:Blue>return</span> <span style=color:Red>0</span>;<br>}<br>